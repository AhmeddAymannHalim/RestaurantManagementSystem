<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Management System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-flex">
            <div class="header-left">
                <div id="userInfo" class="user-info" style="display: none;">
                    <span id="userName" class="user-name-text"></span>
                    <div class="user-menu">
                        <button class="btn-user-menu" onclick="toggleUserMenu(event)">
                            <span id="userInitial" class="user-initial">A</span>
                            <span class="dropdown-arrow">▼</span>
                        </button>
                        <div id="userDropdown" class="user-dropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-avatar">
                                    <span id="dropdownInitial">A</span>
                                </div>
                                <div class="dropdown-user-info">
                                    <div id="dropdownUserName" class="dropdown-name">User Name</div>
                                    <div id="dropdownUserRole" class="dropdown-role">Admin</div>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <button onclick="goToHome()" class="dropdown-item">
                                <span data-i18n="home">🏠 Home</span>
                            </button>
                            <button onclick="goToSwagger()" class="dropdown-item">
                                <span data-i18n="apiDocs">📚 API Docs</span>
                            </button>
                            <div class="dropdown-divider"></div>
                            <button onclick="showChangePasswordModal()" class="dropdown-item">
                                <span data-i18n="changePassword">🔑 Change Password</span>
                            </button>
                            <button onclick="showEditProfileModal()" class="dropdown-item">
                                <span data-i18n="editProfile">👤 Edit Profile</span>
                            </button>
                            <div class="dropdown-divider"></div>
                            <button onclick="logout()" class="dropdown-item dropdown-logout">
                                <span data-i18n="logout">🚪 Logout</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-center">
                <h1 data-i18n="appTitle">🍽️ Restaurant Management System</h1>
            </div>
            <div class="header-right">
                <div class="language-switcher">
                    <button onclick="switchLanguage('en')" class="lang-btn active" id="langEN">EN</button>
                    <button onclick="switchLanguage('ar')" class="lang-btn" id="langAR">عربي</button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="loginSection" class="section" style="display: block;">
            <div class="card">
                <h2 data-i18n="loginTitle">Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label data-i18n="username">Username</label>
                        <input type="text" id="loginUsername" placeholder="admin" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="password">Password</label>
                        <input type="password" id="loginPassword" placeholder="Admin@123" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span data-i18n="loginBtn">LOGIN</span>
                    </button>
                </form>
                <p class="toggle-form">
                    <a href="#" onclick="showForgotPassword(); return false;" class="link">
                        <span data-i18n="forgotPassword">Forgot Password?</span>
                    </a>
                </p>
                <p class="toggle-form">
                    <span data-i18n="noAccount">Don't have an account?</span>
                    <a href="#" onclick="showRegister(); return false;" class="link">
                        <span data-i18n="registerHere">Register here</span>
                    </a>
                </p>
            </div>
        </div>

        <div id="registerSection" class="section" style="display: none;">
            <div class="card">
                <h2 data-i18n="registerTitle">Register</h2>
                <form id="registerForm">
                    <div class="form-group">
                        <label data-i18n="username">Username</label>
                        <input type="text" id="regUsername" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="email">Email</label>
                        <input type="email" id="regEmail" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="password">Password</label>
                        <input type="password" id="regPassword" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="fullName">Full Name</label>
                        <input type="text" id="regFullName" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="role">Role</label>
                        <select id="regRole">
                            <option value="Admin">Admin</option>
                            <option value="Waiter" selected>Waiter</option>
                            <option value="Kitchen">Kitchen</option>
                            <option value="Cashier">Cashier</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span data-i18n="registerBtn">REGISTER</span>
                    </button>
                </form>
                <p class="toggle-form">
                    <span data-i18n="haveAccount">Already have an account?</span>
                    <a href="#" onclick="showLogin(); return false;" class="link">
                        <span data-i18n="loginHere">Login here</span>
                    </a>
                </p>
            </div>
        </div>

        <div id="forgotPasswordSection" class="section" style="display: none;">
            <div class="card">
                <h2 data-i18n="forgotPasswordTitle">Forgot Password</h2>
                <div id="forgotStep1">
                    <form id="forgotPasswordForm">
                        <div class="form-group">
                            <label data-i18n="email">Email</label>
                            <input type="email" id="forgotEmail" required>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span data-i18n="sendOTP">SEND OTP</span>
                        </button>
                    </form>
                </div>
                <div id="forgotStep2" style="display: none;">
                    <form id="resetPasswordForm">
                        <div class="form-group">
                            <label data-i18n="otpCode">OTP Code</label>
                            <input type="text" id="otpCode" required maxlength="6">
                        </div>
                        <div class="form-group">
                            <label data-i18n="newPassword">New Password</label>
                            <input type="password" id="newPassword" required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="confirmPassword">Confirm Password</label>
                            <input type="password" id="confirmPasswordReset" required>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span data-i18n="resetPassword">RESET PASSWORD</span>
                        </button>
                    </form>
                </div>
                <p class="toggle-form">
                    <span data-i18n="rememberPassword">Remember your password?</span>
                    <a href="#" onclick="showLogin(); return false;" class="link">
                        <span data-i18n="loginHere">Login here</span>
                    </a>
                </p>
            </div>
        </div>

        <div id="dashboardSection" class="section" style="display: none;">
            <!-- ✅ SIDEBAR IS BACK! -->
            <div class="dashboard-wrapper">
                <nav class="sidebar-nav">
                    <div class="nav-brand">
                        <span class="nav-icon">🍽️</span>
                        <span class="nav-title">Management</span>
                    </div>
                    <ul class="nav-menu">
                        <li>
                            <button class="nav-btn active" onclick="showTab('categories')" data-tab="categories">
                                <span class="nav-btn-icon">📂</span>
                                <span class="nav-btn-text" data-i18n="categories">Categories</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-btn" onclick="showTab('menuItems')" data-tab="menuItems">
                                <span class="nav-btn-icon">🍜</span>
                                <span class="nav-btn-text" data-i18n="menuItems">Menu Items</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-btn" onclick="showTab('tables')" data-tab="tables">
                                <span class="nav-btn-icon">🪑</span>
                                <span class="nav-btn-text" data-i18n="tables">Tables</span>
                            </button>
                        </li>
                        <li>
                            <button class="nav-btn" onclick="showTab('orders')" data-tab="orders">
                                <span class="nav-btn-icon">📋</span>
                                <span class="nav-btn-text" data-i18n="orders">Orders</span>
                            </button>
                        </li>
                    </ul>
                </nav>

                <main class="main-content">
                    <div id="categoriesTab" class="tab-content active">
                        <div class="tab-header">
                            <h2 data-i18n="categories">Categories</h2>
                            <button class="btn btn-primary" onclick="openModal('createCategoryModal')">
                                <span data-i18n="addCategory">➕ ADD CATEGORY</span>
                            </button>
                        </div>
                        <div id="categoriesList"></div>
                    </div>

                    <div id="menuItemsTab" class="tab-content">
                        <div class="tab-header">
                            <h2 data-i18n="menuItems">Menu Items</h2>
                            <button class="btn btn-primary" onclick="showCreateMenuItemModal()">
                                <span data-i18n="addMenuItem">➕ ADD MENU ITEM</span>
                            </button>
                        </div>
                        <div id="menuItemsList"></div>
                    </div>

                    <div id="tablesTab" class="tab-content">
                        <div class="tab-header">
                            <h2 data-i18n="tables">Tables</h2>
                            <button class="btn btn-primary" onclick="openModal('createTableModal')">
                                <span data-i18n="addTable">➕ ADD TABLE</span>
                            </button>
                        </div>
                        <div id="tablesList"></div>
                    </div>

                    <div id="ordersTab" class="tab-content">
                        <div class="tab-header">
                            <h2 data-i18n="orders">Orders</h2>
                            <button class="btn btn-success" onclick="showCreateOrderModal()">
                                <span data-i18n="newOrder">🎯 NEW ORDER</span>
                            </button>
                        </div>
                        <div id="ordersList"></div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="createCategoryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('createCategoryModal')">&times;</span>
            <h2 data-i18n="createCategory">Create Category</h2>
            <form id="createCategoryForm">
                <div class="form-group">
                    <label data-i18n="categoryName">Category Name</label>
                    <input type="text" id="catName" data-validate="required|minLength:2|maxLength:100" required>
                </div>
                <div class="form-group">
                    <label data-i18n="categoryNameAr">Category Name (Arabic)</label>
                    <input type="text" id="catNameAr" data-validate="minLength:2|maxLength:100">
                </div>
                <div class="form-group">
                    <label data-i18n="description">Description</label>
                    <textarea id="catDescription" data-validate="maxLength:500" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label data-i18n="displayOrder">Display Order</label>
                    <input type="number" id="catDisplayOrder" data-validate="required|minValue:1" value="1" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <span data-i18n="create">Create</span>
                </button>
            </form>
        </div>
    </div>

    <div id="createMenuItemModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('createMenuItemModal')">&times;</span>
            <h2 data-i18n="createMenuItem">Create Menu Item</h2>
            <form id="createMenuItemForm">
                <div class="form-group">
                    <label data-i18n="category">Category</label>
                    <select id="menuItemCategory" required></select>
                </div>
                <div class="form-group">
                    <label data-i18n="itemName">Item Name</label>
                    <input type="text" id="menuItemName" data-validate="required|minLength:2|maxLength:100" required>
                </div>
                <div class="form-group">
                    <label data-i18n="itemNameAr">Item Name (Arabic)</label>
                    <input type="text" id="menuItemNameAr" data-validate="required|minLength:2|maxLength:100" required>
                </div>
                <div class="form-group">
                    <label data-i18n="description">Description</label>
                    <textarea id="menuItemDescription" data-validate="maxLength:500" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label data-i18n="price">Price (EGP)</label>
                    <input type="number" step="0.01" id="menuItemPrice" data-validate="required|number|minValue:0" required>
                </div>
                <div class="form-group">
                    <label data-i18n="imageUrl">Image URL</label>
                    <input type="text" id="menuItemImageUrl" data-validate="url">
                </div>
                <div class="form-group">
                    <label data-i18n="prepTime">Prep Time (mins)</label>
                    <input type="number" id="menuItemPrepTime" data-validate="required|number|minValue:1" value="10" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <span data-i18n="create">Create</span>
                </button>
            </form>
        </div>
    </div>

    <div id="createTableModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('createTableModal')">&times;</span>
            <h2 data-i18n="createTable">Create Table</h2>
            <form id="createTableForm">
                <div class="form-group">
                    <label data-i18n="tableNumber">Table Number</label>
                    <input type="number" id="tableNumber" data-validate="required|number|minValue:1" required>
                </div>
                <div class="form-group">
                    <label data-i18n="capacity">Capacity</label>
                    <input type="number" id="tableCapacity" data-validate="required|number|minValue:1" required>
                </div>
                <div class="form-group">
                    <label data-i18n="floorSection">Floor Section</label>
                    <input type="text" id="tableSection" data-validate="required|minLength:2|maxLength:50" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <span data-i18n="create">Create</span>
                </button>
            </form>
        </div>
    </div>

    <div id="createOrderModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('createOrderModal')">&times;</span>
            <h2 data-i18n="createOrder">Create Order</h2>
            <form id="createOrderForm">
                <div class="form-group">
                    <label data-i18n="selectTable">Select Table</label>
                    <select id="orderTable" required></select>
                </div>
                <div class="form-group">
                    <label data-i18n="notes">Notes</label>
                    <textarea id="orderNotes" rows="2"></textarea>
                </div>
                <h3 data-i18n="orderItems">Order Items</h3>
                <div id="orderItemsList"></div>
                <button type="button" onclick="addOrderItem()" class="btn btn-secondary">
                    <span data-i18n="addItem">+ Add Item</span>
                </button>
                <br><br>
                <button type="submit" class="btn btn-success">
                    <span data-i18n="createOrder">Create Order</span>
                </button>
            </form>
        </div>
    </div>

    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('changePasswordModal')">&times;</span>
            <h2 data-i18n="changePassword">Change Password</h2>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label data-i18n="currentPassword">Current Password</label>
                    <input type="password" id="currentPassword" data-validate="required|minLength:6" required>
                </div>
                <div class="form-group">
                    <label data-i18n="newPassword">New Password</label>
                    <input type="password" id="newPasswordChange" data-validate="required|passwordStrength" required>
                </div>
                <div class="form-group">
                    <label data-i18n="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPasswordChange" data-validate="required|minLength:8" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <span data-i18n="save">Save</span>
                </button>
            </form>
        </div>
    </div>

    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editProfileModal')">&times;</span>
            <h2 data-i18n="editProfile">Edit Profile</h2>
            <form id="editProfileForm">
                <div class="form-group">
                    <label data-i18n="fullName">Full Name</label>
                    <input type="text" id="editFullName" data-validate="required|minLength:3|maxLength:100" required>
                </div>
                <div class="form-group">
                    <label data-i18n="email">Email</label>
                    <input type="email" id="editEmail" data-validate="required|email" required>
                </div>
                <div class="form-group">
                    <label data-i18n="username">Username</label>
                    <input type="text" id="editUsername" disabled>
                </div>
                <button type="submit" class="btn btn-primary">
                    <span data-i18n="save">Save</span>
                </button>
            </form>
        </div>
    </div>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner-circle">
                <div class="spinner-logo">🍽️</div>
            </div>
            <p class="loading-text" data-i18n="loading">Loading...</p>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script src="translations.js"></script>
    <script src="app.js"></script>

    <script>
        // 🔥 REAL-TIME VALIDATION - BUILT IN! 🔥
        const RealTimeValidator = {
            shakeElement(element) {
                element.style.animation = 'none';
                setTimeout(() => {
                    element.style.animation = 'shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97)';
                }, 10);
            },

            showError(input, message) {
                const formGroup = input.closest('.form-group');
                if (!formGroup) return;
                formGroup.classList.add('error');
                formGroup.classList.remove('success');
                this.shakeElement(input);

                let errorMsg = formGroup.querySelector('.error-message');
                if (!errorMsg) {
                    errorMsg = document.createElement('div');
                    errorMsg.className = 'error-message';
                    formGroup.appendChild(errorMsg);
                }
                errorMsg.textContent = message;
                errorMsg.style.opacity = '0';
                setTimeout(() => errorMsg.style.opacity = '1', 10);
            },

            showSuccess(input) {
                const formGroup = input.closest('.form-group');
                if (!formGroup) return;
                formGroup.classList.add('success');
                formGroup.classList.remove('error');

                const errorMsg = formGroup.querySelector('.error-message');
                if (errorMsg) {
                    errorMsg.style.opacity = '0';
                    setTimeout(() => errorMsg.remove(), 300);
                }
            },

            clearValidation(input) {
                const formGroup = input.closest('.form-group');
                if (!formGroup) return;
                formGroup.classList.remove('error', 'success');
                const errorMsg = formGroup.querySelector('.error-message');
                if (errorMsg) {
                    errorMsg.style.opacity = '0';
                    setTimeout(() => errorMsg.remove(), 300);
                }
            },

            validateEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            },

            validatePassword(password) {
                if (password.length < 8) return { valid: false, message: 'Password must be at least 8 characters' };
                if (!/[A-Z]/.test(password)) return { valid: false, message: 'Must contain uppercase letter' };
                if (!/[a-z]/.test(password)) return { valid: false, message: 'Must contain lowercase letter' };
                if (!/[0-9]/.test(password)) return { valid: false, message: 'Must contain number' };
                if (!/[!@#$%^&*]/.test(password)) return { valid: false, message: 'Must contain special character' };
                return { valid: true };
            },

            init() {
                // Login
                const loginUsername = document.getElementById('loginUsername');
                const loginPassword = document.getElementById('loginPassword');

                loginUsername?.addEventListener('input', (e) => {
                    const value = e.target.value.trim();
                    if (value.length === 0) this.clearValidation(loginUsername);
                    else if (value.length < 3) this.showError(loginUsername, 'Username must be 3+ characters');
                    else this.showSuccess(loginUsername);
                });

                loginPassword?.addEventListener('input', (e) => {
                    const value = e.target.value;
                    if (value.length === 0) this.clearValidation(loginPassword);
                    else if (value.length < 6) this.showError(loginPassword, 'Password must be 6+ characters');
                    else this.showSuccess(loginPassword);
                });

                // Register
                const regUsername = document.getElementById('regUsername');
                const regEmail = document.getElementById('regEmail');
                const regPassword = document.getElementById('regPassword');
                const regFullName = document.getElementById('regFullName');

                regUsername?.addEventListener('input', (e) => {
                    const value = e.target.value.trim();
                    if (value.length === 0) this.clearValidation(regUsername);
                    else if (value.length < 3) this.showError(regUsername, 'Username must be 3+ characters');
                    else if (!/^[a-zA-Z0-9_]+$/.test(value)) this.showError(regUsername, 'Only letters, numbers, underscore');
                    else this.showSuccess(regUsername);
                });

                regEmail?.addEventListener('input', (e) => {
                    const value = e.target.value.trim();
                    if (value.length === 0) this.clearValidation(regEmail);
                    else if (!this.validateEmail(value)) this.showError(regEmail, 'Invalid email address');
                    else this.showSuccess(regEmail);
                });

                regPassword?.addEventListener('input', (e) => {
                    const value = e.target.value;
                    if (value.length === 0) this.clearValidation(regPassword);
                    else {
                        const result = this.validatePassword(value);
                        if (result.valid) this.showSuccess(regPassword);
                        else this.showError(regPassword, result.message);
                    }
                });

                regFullName?.addEventListener('input', (e) => {
                    const value = e.target.value.trim();
                    if (value.length === 0) this.clearValidation(regFullName);
                    else if (value.length < 3) this.showError(regFullName, 'Name must be 3+ characters');
                    else if (!/^[a-zA-Z\s]+$/.test(value)) this.showError(regFullName, 'Only letters and spaces');
                    else this.showSuccess(regFullName);
                });

                // Reset Password
                const newPassword = document.getElementById('newPassword');
                const confirmPasswordReset = document.getElementById('confirmPasswordReset');

                newPassword?.addEventListener('input', (e) => {
                    const value = e.target.value;
                    if (value.length === 0) this.clearValidation(newPassword);
                    else {
                        const result = this.validatePassword(value);
                        if (result.valid) this.showSuccess(newPassword);
                        else this.showError(newPassword, result.message);
                    }

                    if (confirmPasswordReset?.value) {
                        if (confirmPasswordReset.value !== value) {
                            this.showError(confirmPasswordReset, 'Passwords do not match');
                        } else {
                            this.showSuccess(confirmPasswordReset);
                        }
                    }
                });

                confirmPasswordReset?.addEventListener('input', (e) => {
                    const value = e.target.value;
                    if (value.length === 0) this.clearValidation(confirmPasswordReset);
                    else if (value !== newPassword?.value) this.showError(confirmPasswordReset, 'Passwords do not match');
                    else this.showSuccess(confirmPasswordReset);
                });

                console.log('✅ Real-time validation initialized');
            }
        };

        // Initialize validation when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => RealTimeValidator.init());
        } else {
            RealTimeValidator.init();
        }
    </script>
</body>
</html>